<footer class="footer">
  <div class="footer__inner">
    <div class="copyright copyright--user">
    {{ if $.Site.Copyright }}
        <span>{{ $.Site.Copyright | safeHTML }} {{ now.Year }}</span>
    {{end}}
        <span>:: Powered by <a href="http://gohugo.io">Hugo</a> {{ hugo.Version }}</span>
    
        <span>:: Theme made by <a href="https://twitter.com/panr">panr</a></span>

    {{ if $.Site.Params.StatusBadge }}
        :: {{ $.Site.Params.StatusBadge | safeHTML }}
    {{end}}
      </div>
  </div>
</footer>

<a id="back-to-top" style="display: inline-block;" href="javascript:void(0);" onclick="window.scrollTo({top: 0, behavior: 'smooth'});">
  <span class="iconfont icon-top"></span>
</a>

<script src="{{ "assets/main.js" | absURL }}?{{ resources.Get "assets/main.js" | md5}}"></script>
{{/*  <script src="{{ "assets/prism.js" | absURL }}"></script>  */}}

<script>
  const addCopyButtons = function(clipboard) {
    document.querySelectorAll('pre > code').forEach(function (codeBlock) {
        const button = document.createElement('button');
        button.className = 'copy-code-button';
        button.type = 'button';
        button.innerText = 'Copy';

        const btnWrapper = document.createElement('div');
        btnWrapper.className = 'copy-code-button-wrap';
        btnWrapper.appendChild(button);
  
        button.addEventListener('click', function () {
            clipboard.writeText(codeBlock.innerText).then(function () {
                /* Chrome doesn't seem to blur automatically,
                   leaving the button in a focused state. */
                button.blur();
  
                button.innerText = 'Done!';
  
                setTimeout(function () {
                    button.innerText = 'Copy';
                }, 2000);
            }, function (error) {
                button.innerText = 'Error';
            });
        });
  
        const pre = codeBlock.parentNode;
        pre.insertAdjacentElement('beforebegin', btnWrapper);
    });
  };

  const loadScript = (url, onloadFunction) => {
    var newScript = document.createElement("script");
    newScript.onerror =  (oError) => {
      throw new URIError("The script " + oError.target.src + " didn't load correctly.");
    };
    if (onloadFunction) { newScript.onload = onloadFunction; }
    document.head.insertAdjacentElement('beforeend', newScript);
    newScript.src = url;
  }

  // mermaid loader by ttys3.dev
  const loadMermaidOnNeed = () => {
    if (document.querySelectorAll('.mermaid').length > 0) {
      loadScript('https://cdn.jsdelivr.net/npm/mermaid@8.10.1/dist/mermaid.min.js', () => {
        document.head.insertAdjacentHTML("beforeend", `<style>.mermaid svg { background-color: #dadcd8 !important; }</style>`);
        // default, dark, neutral, forest
        mermaid.initialize({ startOnLoad: false, securityLevel: "strict", logLevel: 1, theme: "neutral" });
        // https://github.com/mermaid-js/mermaid/blob/e6e94ad57ea06ef8627bf91ddfbd88f5082952bf/src/mermaid.js#L153
        // mermaid.contentLoaded();
        mermaid.init();
        console.log("mermaid init done");
      })
    }
  }

  window.addEventListener('load', function(event) {

    // external link open in new tab
    const links = document.links;
    for (let i = 0, linksLength = links.length; i < linksLength; i++) {
      if (links[i].hostname != window.location.hostname && 
      !links[i].href.startsWith('javascript:') && 
      !links[i].href.startsWith('mailto:')) {
          links[i].target = '_blank';
      } 
    }

    // show toc
    if (document.querySelectorAll('#TableOfContents li').length > 0) {
      document.querySelector('#post-toc').style.display = 'block';
    }
    
    // toc active
    document.querySelectorAll('#post-toc a').forEach(anchor => {
      anchor.addEventListener('click', evt => {
        // remove all .active
        document.querySelectorAll('#post-toc a').forEach(ele => {
          ele.classList.remove('active');
        });
        evt.target.classList.add('active');
      })
    });

    // anchor smooth scroll
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
          e.preventDefault();
    
          // querySelector has limitation due to CSS selector standard
          // like id="1-安装", querySelector('#1-安装') will failed with err
          // SyntaxError: Document.querySelector: '#1-安装' is not a valid selector
          document.getElementById(this.getAttribute('href').substring(1)).scrollIntoView({
              behavior: 'smooth'
          });
      });
    });
    
    // copy code button
    if (navigator && navigator.clipboard) {
      addCopyButtons(navigator.clipboard);
    }

    // load mermaid
    loadMermaidOnNeed();
  });
</script>

<!-- Extended footer section-->
{{ partial "extended_footer.html" . }}
